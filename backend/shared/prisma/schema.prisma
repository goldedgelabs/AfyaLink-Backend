// Append to backend/shared/prisma/schema.prisma

model Encounter {
  id          Int      @id @default(autoincrement())
  patientId   Int
  doctorId    Int?
  hospitalId  Int?
  visitType   String   // outpatient, inpatient, telehealth
  reason      String?
  notes       String?
  startAt     DateTime
  endAt       DateTime?
  createdAt   DateTime @default(now())

  Patient Patient @relation(fields: [patientId], references: [id])

  @@index([patientId])
}

model LabResult {
  id          Int      @id @default(autoincrement())
  patientId   Int
  encounterId Int?
  testName    String
  result      String
  units       String?
  referenceRange String?
  collectedAt DateTime
  reportedAt  DateTime?
  status      String   @default("final") // pending, final, corrected
  meta        Json?
  createdAt   DateTime @default(now())

  Patient Patient @relation(fields: [patientId], references: [id])
}

model Prescription {
  id          Int      @id @default(autoincrement())
  patientId   Int
  prescriberId Int?
  drugs       Json     // [{name, dose, freq, duration}]
  notes       String?
  issuedAt    DateTime @default(now())
  status      String   @default("active") // active, stopped, completed
  createdAt   DateTime @default(now())

  Patient Patient @relation(fields: [patientId], references: [id])
}

model Consent {
  id          Int      @id @default(autoincrement())
  patientId   Int
  scope       String   // "share_records", "research", etc
  granted     Boolean
  grantedBy   Int?     // user id
  grantedAt   DateTime?
  revokedAt   DateTime?
  meta        Json?
  createdAt   DateTime @default(now())

  Patient Patient @relation(fields: [patientId], references: [id])
}

model DeviceTelemetry {
  id        Int      @id @default(autoincrement())
  deviceId  String
  patientId Int?
  metric    String   // heart_rate, bp_sys, bp_dia, glucose
  value     Float
  unit      String?
  ts        DateTime
  meta      Json?
  createdAt DateTime @default(now())

  Patient? Patient @relation(fields: [patientId], references: [id])
}
